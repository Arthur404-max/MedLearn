# MedLearn Admin Panel

Отдельное приложение для оперативного управления пользователями и контентом платформы MedLearn. Админ-панель запускается как простой Express-сервер и проксирует запросы к основному API (`ClioTest2`).

## Возможности
- Панель входа для операторов (локальный пароль по умолчанию `admin2024`)
- Просмотр агрегированной статистики пользователей (активность, подтверждения, премиум-подписки)
- Управление пользователями: бан, разбан, выдача премиум-доступа, смена роли, удаление
- Фильтрация и поиск по email, ролям и статусам
- Прокси-запросы к основному серверу с добавлением служебных заголовков
- Проверка доступности главного API через `/api/health`

## Требования
- Node.js 18+
- Основной сервер MedLearn (`ClioTest2`) доступен по HTTP (обычно `http://localhost:3000`)

## Переменные окружения
Создайте в каталоге админ-панели файл `.env`:
```
ADMIN_PORT=3002
MAIN_SERVER_URL=http://localhost:3000
ADMIN_PASSWORD=admin2024
```
`ADMIN_PASSWORD` переопределяет пароль из скриптов авторизации. Измените значение перед публикацией.

## Установка и запуск
1. Перейдите в каталог админки: `cd admin-panel`
2. Установите зависимости: `npm install`
3. Убедитесь, что основной сервер запущен и `.env` заполнен
4. Запустите приложение:
   - `npm run dev` — горячая перезагрузка через nodemon
   - `npm start` — продакшн-режим

Приложение будет доступно на `http://localhost:3002` (порт задается переменной `ADMIN_PORT`).

## Взаимодействие с API
- Все запросы из интерфейса проходят через эндпоинт `/api/proxy`, который пробрасывает их на `MAIN_SERVER_URL`
- Заголовок `X-Admin-Panel: true` добавляется автоматически и обрабатывается middleware основного сервера (`middleware/auth.ts`)
- Для временных сценариев используется токен `admin-panel-access-key`; настройте полноценную авторизацию в `server.js`, когда подключите реальный SSO или JWT

## Интерфейс
- `/` — главная панель с показателями
- `/login` — форма входа
- `/users.html` — управление пользователями (фильтрация, поиск, действия)
- Файлы интерфейса находятся в `public/`, стили и скрипты разложены по подпапкам

## Отладка и диагностика
- Включите консоль браузера, чтобы видеть запросы и ответы прокси
- Сервер печатает информацию о каждом проксируемом запросе и ответе в терминал
- Эндпоинт `http://localhost:3002/api/health` проверяет связь с основным API

## Безопасность и доработка
- Замените стандартный пароль и токен, прежде чем открывать панель в сеть
- Добавьте реальную схему авторизации (JWT/SSO) и хранение учетных данных в БД
- Ограничьте доступ к панели через VPN, ACL или базовую авторизацию на уровне Nginx
- При необходимости расширьте `public/users-management.js` для работы с новыми эндпоинтами (категории, тесты, ресурсы)

Документацию по основному серверу и процессу деплоя смотрите в корневом `README.md` и `PRODUCTION_DEPLOY_GUIDE.md` проекта.
