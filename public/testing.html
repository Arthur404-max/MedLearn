<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ - MedLearn</title>
    <link rel="stylesheet" href="/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <!-- –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ —Ñ–∞–∫—Ç—ã –Ω–∞ —Ñ–æ–Ω–µ -->
    <div class="medical-facts-bg">
        <div class="medical-fact">–ù–µ–π—Ä–æ–Ω—ã –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è, –Ω–æ –æ–±—Ä–∞–∑—É—é—Ç –Ω–æ–≤—ã–µ —Å–≤—è–∑–∏ –≤—Å—é –∂–∏–∑–Ω—å</div>
        <div class="medical-fact">–°–µ—Ä–¥—Ü–µ –Ω–∞—á–∏–Ω–∞–µ—Ç –±–∏—Ç—å—Å—è –Ω–∞ 4-–π –Ω–µ–¥–µ–ª–µ —Ä–∞–∑–≤–∏—Ç–∏—è —ç–º–±—Ä–∏–æ–Ω–∞</div>
        <div class="medical-fact">–ò–º–º—É–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç –≤—Å–µ –≤—Å—Ç—Ä–µ—á–µ–Ω–Ω—ã–µ –ø–∞—Ç–æ–≥–µ–Ω—ã</div>
        <div class="medical-fact">–ö–æ—Å—Ç–Ω—ã–π –º–æ–∑–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç 2 –º–∏–ª–ª–∏–æ–Ω–∞ –∫—Ä–∞—Å–Ω—ã—Ö –∫—Ä–æ–≤—è–Ω—ã—Ö —Ç–µ–ª–µ—Ü –≤ —Å–µ–∫—É–Ω–¥—É</div>
        <div class="medical-fact">–ß–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–π —è–∑—ã–∫ –∏–º–µ–µ—Ç –æ—Ç–ø–µ—á–∞—Ç–æ–∫, —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–∞–∫ –æ—Ç–ø–µ—á–∞—Ç–æ–∫ –ø–∞–ª—å—Ü–∞</div>
    </div>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="navbar">
        <div class="navbar-content">
                        <a href="dashboard.html" class="logo" style="text-decoration: none; color: inherit;">üè• MedLearn</a>
            <div class="nav-links">
                <a href="dashboard.html">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
                <a href="resources.html">–†–µ—Å—É—Ä—Å—ã</a>
                <a href="subscription.html">–ü–æ–¥–ø–∏—Å–∫–∞</a>
                <a href="profile.html">–ü—Ä–æ—Ñ–∏–ª—å</a>
                <button onclick="logout()" class="btn btn-secondary">–í—ã–π—Ç–∏</button>
            </div>
        </div>
    </nav>

    <div class="app-container">
        <div class="page-header">
            <h1>üß† –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h1>
            <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏ —É–ª—É—á—à–∏—Ç–µ —Å–≤–æ–∏ –∑–Ω–∞–Ω–∏—è –ø–æ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–º –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞–º</p>
        </div>

        <div class="content-wrapper">
            <!-- –í—ã–±–æ—Ä –ø—Ä–µ–¥–º–µ—Ç–∞ -->
            <div id="subjectSelection" class="card">
                <div class="card-header">
                    <h2 class="card-title">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è</h2>
                    <p class="card-subtitle">–î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã</p>
                </div>
                <div class="card-body">
                    <div class="grid grid-3" id="subjectsGrid">
                        <!-- –ü—Ä–µ–¥–º–µ—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>
            </div>

            <!-- –í—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
            <div id="categorySelection" class="card" style="display: none;">
                <div class="card-header">
                    <h2 class="card-title">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h2>
                    <p class="card-subtitle">–†–∞–∑–¥–µ–ª—ã –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞</p>
                </div>
                <div class="card-body">
                    <button onclick="showSubjects()" class="btn btn-secondary" style="margin-bottom: 1rem;">‚Üê –ù–∞–∑–∞–¥ –∫ –ø—Ä–µ–¥–º–µ—Ç–∞–º</button>
                    <div class="grid grid-2" id="categoriesGrid">
                        <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>
            </div>

            <!-- –í—ã–±–æ—Ä –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
            <div id="subcategorySelection" class="card" style="display: none;">
                <div class="card-header">
                    <h2 class="card-title">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É</h2>
                    <p class="card-subtitle">–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–µ–º—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</p>
                </div>
                <div class="card-body">
                    <button onclick="showCategories()" class="btn btn-secondary" style="margin-bottom: 1rem;">‚Üê –ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</button>
                    <div class="grid grid-2" id="subcategoriesGrid">
                        <!-- –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>
            </div>

            <!-- –¢–µ—Å—Ç -->
            <div id="testContainer" class="card" style="display: none;">
                <div class="card-header">
                    <h2 class="card-title" id="testTitle">–¢–µ—Å—Ç</h2>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <p class="card-subtitle" id="testProgress">–í–æ–ø—Ä–æ—Å 1 –∏–∑ 10</p>
                        <div id="timer" style="font-weight: 600; color: var(--primary-color);">15:00</div>
                    </div>
                </div>
                <div class="card-body">
                    <div id="questionContainer">
                        <h3 id="questionText" style="margin-bottom: 1.5rem; font-size: 1.2rem; line-height: 1.6;"></h3>
                        <div id="answersContainer" class="grid" style="gap: 1rem;">
                            <!-- –í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ -->
                        </div>
                        <div style="margin-top: 2rem; display: flex; justify-content: space-between;">
                            <button onclick="previousQuestion()" class="btn btn-secondary" id="prevBtn" disabled>–ü—Ä–µ–¥—ã–¥—É—â–∏–π</button>
                            <button onclick="nextQuestion()" class="btn btn-primary" id="nextBtn">–°–ª–µ–¥—É—é—â–∏–π</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞ -->
            <div id="resultsContainer" class="card" style="display: none;">
                <div class="card-header">
                    <h2 class="card-title">üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞</h2>
                    <p class="card-subtitle">–í–∞—à–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</p>
                </div>
                <div class="card-body">
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;" id="resultEmoji">üéØ</div>
                        <h3 style="font-size: 2rem; margin-bottom: 0.5rem;" id="scorePercentage">85%</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;" id="scoreDetails">–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤: 17 –∏–∑ 20</p>
                        <div style="background: var(--success-gradient); color: white; padding: 1rem; border-radius: 12px; display: inline-block;">
                            <strong id="resultMessage">–û—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç!</strong>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                        <button onclick="showSubjects()" class="btn btn-primary">–ü—Ä–æ–π—Ç–∏ –¥—Ä—É–≥–æ–π —Ç–µ—Å—Ç</button>
                        <button onclick="window.location.href='dashboard.html'" class="btn btn-secondary">–í –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/client.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üîç –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é (–Ω–æ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É –ø—Ä–µ–¥–º–µ—Ç–æ–≤)
            const isAuth = checkAuth();
            console.log('üîê –°—Ç–∞—Ç—É—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', isAuth);
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–µ–¥–º–µ—Ç—ã –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            console.log('üìö –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –ø—Ä–µ–¥–º–µ—Ç–æ–≤...');
            loadSubjects().then(() => {
                console.log('‚úÖ –ü—Ä–µ–¥–º–µ—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
            }).catch(error => {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–µ–¥–º–µ—Ç–æ–≤:', error);
                
                // Fallback: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –µ—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å
                const subjectsGrid = document.getElementById('subjectsGrid');
                if (subjectsGrid) {
                    subjectsGrid.innerHTML = `
                        <div style="grid-column: 1/-1; text-align: center; padding: 2rem;">
                            <h3>‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ —Å –∑–∞–≥—Ä—É–∑–∫–æ–π —Ç–µ—Å—Ç–æ–≤</h3>
                            <p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–µ–¥–º–µ—Ç–æ–≤. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ:</p>
                            <ul style="text-align: left; display: inline-block;">
                                <li>–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</li>
                                <li>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É</li>
                                <li>–í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É —á–µ—Ä–µ–∑ <a href="auth.html">–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é</a></li>
                            </ul>
                            <button onclick="location.reload()" class="btn btn-primary">–û–±–Ω–æ–≤–∏—Ç—å</button>
                        </div>
                    `;
                }
            });
        });
        
        // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        async function loadSubjectsPublic() {
            try {
                console.log('üì° –ó–∞–ø—Ä–æ—Å –∫ API –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...');
                const response = await fetch('/api/tests/subjects');
                console.log('üìä –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', response.status);
                
                const data = await response.json();
                console.log('üìã –î–∞–Ω–Ω—ã–µ:', data);
                
                if (response.ok && data.length > 0) {
                    const subjectsGrid = document.getElementById('subjectsGrid');
                    if (subjectsGrid) {
                        subjectsGrid.innerHTML = data.map(subject => `
                            <div class="card" onclick="selectSubject(${subject.id})" style="cursor: pointer;">
                                <div class="card-body" style="text-align: center;">
                                    <div style="font-size: 3rem; margin-bottom: 1rem;">${getSubjectIcon(subject.name)}</div>
                                    <h3 class="card-title">${subject.name}</h3>
                                    <p class="card-subtitle">${subject.description}</p>
                                </div>
                            </div>
                        `).join('');
                        console.log('‚úÖ –ü—Ä–µ–¥–º–µ—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ');
                    }
                } else {
                    throw new Error('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –æ—à–∏–±–∫–∞ –æ—Ç–≤–µ—Ç–∞');
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–µ–¥–º–µ—Ç–æ–≤:', error);
            }
        }
    </script>
</body>
</html>