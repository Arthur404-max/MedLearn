<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω - MedLearn</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .ban-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }
        
        .ban-modal {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 100%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: modalAppear 0.5s ease-out;
        }
        
        @keyframes modalAppear {
            from {
                opacity: 0;
                transform: scale(0.8) translateY(-50px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        .ban-icon {
            font-size: 80px;
            margin-bottom: 20px;
            color: #e74c3c;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .ban-title {
            color: #2c3e50;
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 15px;
        }
        
        .ban-subtitle {
            color: #7f8c8d;
            font-size: 18px;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        
        .ban-info {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid #e74c3c;
        }
        
        .ban-reason {
            font-size: 16px;
            color: #2c3e50;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .ban-details {
            font-size: 14px;
            color: #7f8c8d;
            line-height: 1.5;
        }
        
        .ban-timer {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            border-radius: 12px;
            padding: 20px;
            margin: 25px 0;
            font-size: 18px;
            font-weight: 600;
        }
        
        .permanent-ban {
            background: linear-gradient(135deg, #2c3e50, #34495e);
        }
        
        .timer-value {
            font-size: 28px;
            font-weight: 700;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
        }
        
        .back-button {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }
        
        .back-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(116, 185, 255, 0.3);
        }
        
        .contact-info {
            margin-top: 30px;
            padding: 20px;
            background: #e3f2fd;
            border-radius: 12px;
            color: #1565c0;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .contact-link {
            color: #1565c0;
            text-decoration: none;
            font-weight: 600;
        }
        
        .contact-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="ban-container">
        <div class="ban-modal">
            <div class="ban-icon" id="banIcon">üö´</div>
            <h1 class="ban-title" id="banTitle">–î–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω</h1>
            <p class="ban-subtitle" id="banSubtitle">–í–∞—à –∞–∫–∫–∞—É–Ω—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</p>
            
            <div class="ban-info">
                <div class="ban-reason" id="banReason">
                    –ü—Ä–∏—á–∏–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–∞
                </div>
                <div class="ban-details" id="banDetails"></div>
            </div>
            
            <div class="ban-timer" id="banTimer" style="display: none;">
                <div>–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑:</div>
                <div class="timer-value" id="timerValue">00:00:00</div>
                <div id="timerText">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞</div>
            </div>
            
            <div class="contact-info">
                <strong>–í–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã?</strong><br>
                –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ —Å–ª—É–∂–±—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏:<br>
                üìß Email: <a href="mailto:support@medlearn.ru" class="contact-link">support@medlearn.ru</a><br>
                üìû –¢–µ–ª–µ—Ñ–æ–Ω: <a href="tel:+78001234567" class="contact-link">8-800-123-45-67</a>
            </div>
            
            <button class="back-button" onclick="goToMainPage()">
                üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é
            </button>
        </div>
    </div>

    <script>
        let banData = null;
        let timerInterval = null;

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –±–∞–Ω–µ –∏–∑ localStorage –∏–ª–∏ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
        function getBanData() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º localStorage
            const storedBan = localStorage.getItem('banInfo');
            if (storedBan) {
                try {
                    return JSON.parse(storedBan);
                } catch (e) {
                    console.error('Error parsing ban data:', e);
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('banned')) {
                return {
                    ban_reason: urlParams.get('reason') || '–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã',
                    banned_until: urlParams.get('until'),
                    is_permanent: urlParams.get('permanent') === 'true'
                };
            }
            
            return null;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –±–∞–Ω–∞
        function initBanPage() {
            banData = getBanData();
            
            if (!banData) {
                // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –æ –±–∞–Ω–µ –Ω–µ—Ç, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é
                window.location.href = '/';
                return;
            }
            
            updateBanDisplay();
            
            if (!banData.is_permanent && banData.banned_until) {
                startTimer();
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±–∞–Ω–µ
        function updateBanDisplay() {
            const reasonEl = document.getElementById('banReason');
            const detailsEl = document.getElementById('banDetails');
            const timerEl = document.getElementById('banTimer');
            const iconEl = document.getElementById('banIcon');
            const titleEl = document.getElementById('banTitle');
            const subtitleEl = document.getElementById('banSubtitle');
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∏—á–∏–Ω—É –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
            reasonEl.textContent = banData.ban_reason || '–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã';
            
            if (banData.is_permanent) {
                // –ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
                iconEl.textContent = '‚õî';
                titleEl.textContent = '–ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞';
                subtitleEl.textContent = '–í–∞—à –∞–∫–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –Ω–∞–≤—Å–µ–≥–¥–∞';
                timerEl.style.display = 'block';
                timerEl.className = 'ban-timer permanent-ban';
                timerEl.innerHTML = `
                    <div style="font-size: 24px; margin-bottom: 10px;">‚ö†Ô∏è</div>
                    <div style="font-size: 18px;">–ü–û–°–¢–û–Ø–ù–ù–ê–Ø –ë–õ–û–ö–ò–†–û–í–ö–ê</div>
                    <div style="font-size: 14px; margin-top: 10px; opacity: 0.8;">
                        –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤–æ–∑–º–æ–∂–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
                    </div>
                `;
                
                detailsEl.innerHTML = `
                    <strong>–¢–∏–ø:</strong> –ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞<br>
                    <strong>–î–∞—Ç–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:</strong> ${banData.banned_at ? 
                        new Date(banData.banned_at).toLocaleString('ru-RU') : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}<br>
                    <strong>–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:</strong> –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ —Å–ª—É–∂–±—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏
                `;
            } else if (banData.banned_until) {
                // –í—Ä–µ–º–µ–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
                const untilDate = new Date(banData.banned_until);
                const now = new Date();
                
                if (untilDate <= now) {
                    // –ë–∞–Ω –∏—Å—Ç–µ–∫ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º
                    showExpiredBan();
                    return;
                }
                
                detailsEl.innerHTML = `
                    <strong>–¢–∏–ø:</strong> –í—Ä–µ–º–µ–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞<br>
                    <strong>–î–∞—Ç–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:</strong> ${banData.banned_at ? 
                        new Date(banData.banned_at).toLocaleString('ru-RU') : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}<br>
                    <strong>–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–æ:</strong> ${untilDate.toLocaleString('ru-RU')}
                `;
            } else {
                // –ù–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
                detailsEl.innerHTML = `
                    <strong>–¢–∏–ø:</strong> –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º<br>
                    <strong>–î–∞—Ç–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:</strong> ${banData.banned_at ? 
                        new Date(banData.banned_at).toLocaleString('ru-RU') : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}
                `;
            }
        }

        // –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á–µ—Ç–∞
        function startTimer() {
            if (!banData.banned_until) return;
            
            const timerEl = document.getElementById('banTimer');
            const timerValueEl = document.getElementById('timerValue');
            
            timerEl.style.display = 'block';
            
            function updateTimer() {
                const now = new Date();
                const until = new Date(banData.banned_until);
                const diff = until.getTime() - now.getTime();
                
                if (diff <= 0) {
                    // –ë–∞–Ω –∏—Å—Ç–µ–∫
                    clearInterval(timerInterval);
                    showExpiredBan();
                    return;
                }
                
                const hours = Math.floor(diff / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                
                timerValueEl.textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
            
            updateTimer();
            timerInterval = setInterval(updateTimer, 1000);
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –±–∞–Ω–∞
        function showExpiredBan() {
            const modal = document.querySelector('.ban-modal');
            modal.innerHTML = `
                <div class="ban-icon" style="color: #27ae60;">‚úÖ</div>
                <h1 class="ban-title" style="color: #27ae60;">–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–Ω—è—Ç–∞</h1>
                <p class="ban-subtitle">–í–∞—à –∞–∫–∫–∞—É–Ω—Ç —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</p>
                
                <div style="background: #d5f4e6; border-radius: 15px; padding: 25px; margin: 20px 0; border-left: 5px solid #27ae60;">
                    <div style="font-size: 16px; color: #2c3e50; margin-bottom: 15px; font-weight: 600;">
                        üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –æ–±—Ä–∞—Ç–Ω–æ!
                    </div>
                    <div style="font-size: 14px; color: #7f8c8d; line-height: 1.5;">
                        –°—Ä–æ–∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏—Å—Ç–µ–∫. –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É.<br>
                        –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ–±–ª—é–¥–∞–π—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã.
                    </div>
                </div>
                
                <button class="back-button" onclick="goToLogin()" style="background: linear-gradient(135deg, #27ae60, #2ecc71);">
                    üîë –í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É
                </button>
            `;
            
            // –û—á–∏—â–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–∞–Ω–µ
            localStorage.removeItem('banInfo');
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                goToLogin();
            }, 5000);
        }

        // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        function goToMainPage() {
            // –û—á–∏—â–∞–µ–º —Ç–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –µ—Å–ª–∏ –µ—Å—Ç—å
            localStorage.removeItem('token');
            localStorage.removeItem('banInfo');
            window.location.href = '/';
        }

        // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞
        function goToLogin() {
            localStorage.removeItem('banInfo');
            window.location.href = '/';
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ API
        async function checkUserStatus() {
            try {
                const token = localStorage.getItem('token');
                if (!token) return;
                
                const response = await fetch('/api/auth/status', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.status === 403) {
                    const data = await response.json();
                    if (data.error === 'USER_BANNED') {
                        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–∞–Ω–µ
                        banData = data;
                        localStorage.setItem('banInfo', JSON.stringify(data));
                        updateBanDisplay();
                        
                        if (!data.is_permanent && data.banned_until) {
                            if (timerInterval) clearInterval(timerInterval);
                            startTimer();
                        }
                    }
                } else if (response.ok) {
                    // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º
                    localStorage.removeItem('banInfo');
                    window.location.href = '/dashboard.html';
                }
            } catch (error) {
                console.error('Error checking user status:', error);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            initBanPage();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            setInterval(checkUserStatus, 30000);
        });

        // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('beforeunload', () => {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
        });
    </script>
</body>
</html>