<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ Email - MedLearn</title>
    <link rel="stylesheet" href="/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <!-- –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ —Ñ–∞–∫—Ç—ã –Ω–∞ —Ñ–æ–Ω–µ -->
    <div class="medical-facts-bg">
        <div class="medical-fact">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤–∞—à–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞</div>
        <div class="medical-fact">–ó–∞—â–∏—â–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø - –æ—Å–Ω–æ–≤–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è</div>
        <div class="medical-fact">–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</div>
    </div>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="navbar">
        <div class="navbar-content">
            <a href="dashboard.html" class="logo" style="text-decoration: none; color: inherit;">üè• MedLearn</a>
        </div>
    </nav>

    <div class="app-container">
        <div class="auth-wrapper">
            <div class="card" style="max-width: 500px; margin: 4rem auto;">
                <div class="card-header" style="text-align: center;">
                    <h1 class="card-title">üìß –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ Email</h1>
                </div>
                <div class="card-body">
                    <div id="verificationStatus" style="text-align: center; padding: 2rem;">
                        <div class="spinner" style="margin: 0 auto 1rem;"></div>
                        <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞—à —Ç–æ–∫–µ–Ω –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è...</p>
                    </div>

                    <!-- –§–æ—Ä–º–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ -->
                    <div id="resendForm" style="display: none;">
                        <div style="text-align: center; margin-bottom: 2rem; color: var(--text-secondary);">
                            <p>–ù–µ –ø–æ–ª—É—á–∏–ª–∏ –ø–∏—Å—å–º–æ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º?</p>
                        </div>
                        <form id="resendVerificationForm">
                            <div class="form-group">
                                <label for="email">Email –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏:</label>
                                <input type="email" id="email" placeholder="–≤–∞—à@email.com" required>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                üìß –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ
                            </button>
                        </form>
                    </div>

                    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç -->
                    <div id="result" style="display: none; text-align: center; padding: 2rem;">
                        <div id="resultIcon" style="font-size: 4rem; margin-bottom: 1rem;"></div>
                        <h3 id="resultTitle"></h3>
                        <p id="resultMessage" style="color: var(--text-secondary); margin-bottom: 2rem;"></p>
                        <div id="resultActions"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .auth-wrapper {
            min-height: calc(100vh - 100px);
            display: flex;
            align-items: center;
            padding: 2rem;
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('token');

            if (token) {
                verifyEmail(token);
            } else {
                showResendForm();
            }
        });

        async function verifyEmail(token) {
            try {
                const response = await fetch(`/api/auth/verify-email?token=${token}`);
                const data = await response.json();

                if (response.ok) {
                    showResult('‚úÖ', 'Email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω!', data.message, `
                        <a href="auth.html" class="btn btn-primary">–í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</a>
                    `);
                } else {
                    showResult('‚ùå', '–û—à–∏–±–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è', data.message, `
                        <button onclick="showResendForm()" class="btn btn-secondary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –ø–∏—Å—å–º–æ</button>
                        <a href="index.html" class="btn btn-primary" style="margin-left: 1rem;">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
                    `);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                showResult('‚ùå', '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', '–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è', `
                    <button onclick="showResendForm()" class="btn btn-secondary">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –µ—â–µ —Ä–∞–∑</button>
                    <a href="index.html" class="btn btn-primary" style="margin-left: 1rem;">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
                `);
            }
        }

        function showResult(icon, title, message, actions) {
            document.getElementById('verificationStatus').style.display = 'none';
            document.getElementById('resendForm').style.display = 'none';
            
            document.getElementById('resultIcon').textContent = icon;
            document.getElementById('resultTitle').textContent = title;
            document.getElementById('resultMessage').textContent = message;
            document.getElementById('resultActions').innerHTML = actions;
            document.getElementById('result').style.display = 'block';
        }

        function showResendForm() {
            document.getElementById('verificationStatus').style.display = 'none';
            document.getElementById('result').style.display = 'none';
            document.getElementById('resendForm').style.display = 'block';
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
        document.getElementById('resendVerificationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const submitBtn = this.querySelector('button[type="submit"]');
            
            submitBtn.disabled = true;
            submitBtn.textContent = '–û—Ç–ø—Ä–∞–≤–ª—è–µ–º...';

            try {
                const response = await fetch('/api/auth/resend-verification', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email })
                });

                const data = await response.json();

                if (response.ok) {
                    showResult('üìß', '–ü–∏—Å—å–º–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!', data.message, `
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞—à—É –ø–æ—á—Ç—É –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ –≤ –ø–∏—Å—å–º–µ</p>
                        <a href="index.html" class="btn btn-primary">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
                    `);
                } else {
                    showResult('‚ùå', '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏', data.message, `
                        <button onclick="showResendForm()" class="btn btn-secondary">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –µ—â–µ —Ä–∞–∑</button>
                        <a href="index.html" class="btn btn-primary" style="margin-left: 1rem;">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
                    `);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                showResult('‚ùå', '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∏—Å—å–º–æ', `
                    <button onclick="showResendForm()" class="btn btn-secondary">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –µ—â–µ —Ä–∞–∑</button>
                    <a href="index.html" class="btn btn-primary" style="margin-left: 1rem;">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
                `);
            }

            submitBtn.disabled = false;
            submitBtn.textContent = 'üìß –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ';
        });
    </script>
</body>
</html>