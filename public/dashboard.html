<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç - MedLearn</title>
    <link rel="stylesheet" href="/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <!-- –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ —Ñ–∞–∫—Ç—ã –Ω–∞ —Ñ–æ–Ω–µ -->
    <div class="medical-facts-bg">
        <div class="medical-fact">–ú–æ–∑–≥ –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç –≥–ª—é–∫–æ–∑—É –≤ –∫–∞—á–µ—Å—Ç–≤–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ —ç–Ω–µ—Ä–≥–∏–∏</div>
        <div class="medical-fact">–ß–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–µ —Ç–µ–ª–æ —Å–æ—Å—Ç–æ–∏—Ç –Ω–∞ 60% –∏–∑ –≤–æ–¥—ã</div>
        <div class="medical-fact">–í —Ç–µ–ª–µ —á–µ–ª–æ–≤–µ–∫–∞ 206 –∫–æ—Å—Ç–µ–π –∏ –±–æ–ª–µ–µ 600 –º—ã—à—Ü</div>
        <div class="medical-fact">–õ–µ–≥–∫–∏–µ –≤–∑—Ä–æ—Å–ª–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç –æ–∫–æ–ª–æ 2400 –∫–º –¥—ã—Ö–∞—Ç–µ–ª—å–Ω—ã—Ö –ø—É—Ç–µ–π</div>
        <div class="medical-fact">–ö–æ–∂–∞ —è–≤–ª—è–µ—Ç—Å—è —Å–∞–º—ã–º –±–æ–ª—å—à–∏–º –æ—Ä–≥–∞–Ω–æ–º —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–≥–æ —Ç–µ–ª–∞</div>
    </div>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="navbar">
        <div class="navbar-content">
                        <a href="dashboard.html" class="logo" style="text-decoration: none; color: inherit;">üè• MedLearn</a>
            <div class="nav-links">
                <a href="testing.html">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</a>
                <a href="resources.html">–†–µ—Å—É—Ä—Å—ã</a>
                <a href="subscription.html">–ü–æ–¥–ø–∏—Å–∫–∞</a>
                <a href="profile.html">–ü—Ä–æ—Ñ–∏–ª—å</a>
                <button onclick="logout()" class="btn btn-secondary">–í—ã–π—Ç–∏</button>
            </div>
        </div>
    </nav>

    <div class="app-container">
        <div class="page-header">
            <h1>üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <span id="userName">–°—Ç—É–¥–µ–Ω—Ç</span>!</h1>
            <p>–í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≤ –∏–∑—É—á–µ–Ω–∏–∏ –º–µ–¥–∏—Ü–∏–Ω—ã</p>
        </div>

        <div class="content-wrapper">
            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="grid grid-4" style="margin-bottom: 2rem;">
                <div class="card">
                    <div class="card-body" style="text-align: center;">
                        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üìä</div>
                        <h3 style="color: var(--primary-color); font-size: 2rem; margin-bottom: 0.5rem;" id="totalTests">0</h3>
                        <p style="color: var(--text-secondary);">–ü—Ä–æ–π–¥–µ–Ω–æ —Ç–µ—Å—Ç–æ–≤</p>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-body" style="text-align: center;">
                        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üéØ</div>
                        <h3 style="color: var(--success-color); font-size: 2rem; margin-bottom: 0.5rem;" id="averageScore">0%</h3>
                        <p style="color: var(--text-secondary);">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</p>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-body" style="text-align: center;">
                        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üèÜ</div>
                        <h3 style="color: var(--warning-color); font-size: 2rem; margin-bottom: 0.5rem;" id="achievements">0</h3>
                        <p style="color: var(--text-secondary);">–î–æ—Å—Ç–∏–∂–µ–Ω–∏–π</p>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-body" style="text-align: center;">
                        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üìö</div>
                        <h3 style="color: var(--secondary-color); font-size: 2rem; margin-bottom: 0.5rem;" id="studyDays">0</h3>
                        <p style="color: var(--text-secondary);">–î–Ω–µ–π –æ–±—É—á–µ–Ω–∏—è</p>
                    </div>
                </div>
            </div>

            <div class="grid grid-2">
                <!-- –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">üìà –ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è</h2>
                        <p class="card-subtitle">–í–∞—à–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Ç–µ—Å—Ç—ã</p>
                    </div>
                    <div class="card-body">
                        <div id="progressChart" style="height: 200px; display: flex; align-items: center; justify-content: center; color: var(--text-light);">
                            –ì—Ä–∞—Ñ–∏–∫ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –ø–æ—Å–ª–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤
                        </div>
                    </div>
                </div>

                <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h2>
                        <p class="card-subtitle">–í–∞—à–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–∞–≥—Ä–∞–¥—ã</p>
                    </div>
                    <div class="card-body">
                        <div id="achievementsList">
                            <div style="text-align: center; color: var(--text-light); padding: 2rem;">
                                –ü—Ä–æ–π–¥–∏—Ç–µ –ø–µ—Ä–≤—ã–π —Ç–µ—Å—Ç, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è!
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
            <div class="card" style="margin-top: 2rem;">
                <div class="card-header">
                    <h2 class="card-title">üöÄ –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h2>
                    <p class="card-subtitle">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ –æ–±—É—á–µ–Ω–∏–µ</p>
                </div>
                <div class="card-body">
                    <div class="grid grid-3">
                        <div class="feature-card" onclick="window.location.href='testing.html'" style="cursor: pointer;">
                            <div class="feature-icon">üìù</div>
                            <h3>–ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç</h3>
                            <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤–æ–∏ –∑–Ω–∞–Ω–∏—è –ø–æ –ª—é–±–æ–π –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–µ</p>
                        </div>
                        
                        <div class="feature-card" onclick="window.location.href='resources.html'" style="cursor: pointer;">
                            <div class="feature-icon">üìñ</div>
                            <h3>–ò–∑—É—á–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª—ã</h3>
                            <p>–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —É—á–µ–±–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã –∏ —Ä–∞—Å—à–∏—Ä—å—Ç–µ –∑–Ω–∞–Ω–∏—è</p>
                        </div>
                        
                        <div class="feature-card" onclick="window.location.href='subscription.html'" style="cursor: pointer;">
                            <div class="feature-icon">‚≠ê</div>
                            <h3>–£–ª—É—á—à–∏—Ç—å –ø–ª–∞–Ω</h3>
                            <p>–ü–æ–ª—É—á–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—É –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
            <div class="card" style="margin-top: 2rem;">
                <div class="card-header">
                    <h2 class="card-title">üë§ –ü—Ä–æ—Ñ–∏–ª—å</h2>
                    <p class="card-subtitle">–í–∞—à–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</p>
                </div>
                <div class="card-body">
                    <div class="grid grid-2" style="align-items: start;">
                        <div>
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" id="userEmail" readonly style="background: var(--bg-secondary);">
                            </div>
                            <div class="form-group">
                                <label>–ò–º—è</label>
                                <input type="text" id="userFirstName" readonly style="background: var(--bg-secondary);">
                            </div>
                            <div class="form-group">
                                <label>–§–∞–º–∏–ª–∏—è</label>
                                <input type="text" id="userLastName" readonly style="background: var(--bg-secondary);">
                            </div>
                        </div>
                        <div>
                            <div class="form-group">
                                <label>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</label>
                                <input type="text" id="registrationDate" readonly style="background: var(--bg-secondary);">
                            </div>
                            <div class="form-group">
                                <label>–°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏</label>
                                <input type="text" id="subscriptionStatus" readonly style="background: var(--bg-secondary);">
                            </div>
                            <div class="form-group">
                                <label>–†–æ–ª—å</label>
                                <input type="text" id="userRole" readonly style="background: var(--bg-secondary);">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/client.js"></script>
    <script>
        let currentUser = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            loadDashboardData();
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –¥—ç—à–±–æ—Ä–¥–∞
        async function loadDashboardData() {
            console.log('üè† –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥—ç—à–±–æ—Ä–¥–∞...');
            
            try {
                await Promise.all([
                    loadUserProfile(),
                    loadUserStats(),
                    loadAchievements()
                ]);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∞–¥–º–∏–Ω —Ñ—É–Ω–∫—Ü–∏–π
                checkAdminAccess();
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥—ç—à–±–æ—Ä–¥–∞:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function loadUserProfile() {
            try {
                console.log('üë§ –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å –¥–ª—è –¥—ç—à–±–æ—Ä–¥–∞...');
                
                const token = localStorage.getItem('token');
                if (!token) return;
                
                const response = await fetch('/api/user/profile', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const user = await response.json();
                    currentUser = user;
                    console.log('‚úÖ –ü—Ä–æ—Ñ–∏–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω:', user.email, '–†–æ–ª—å:', user.role);
                    
                    // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è
                    document.getElementById('userName').textContent = 
                        user.first_name ? `${user.first_name} ${user.last_name || ''}`.trim() : '–°—Ç—É–¥–µ–Ω—Ç';
                    
                    document.getElementById('userEmail').value = user.email || '';
                    document.getElementById('userFirstName').value = user.first_name || '';
                    document.getElementById('userLastName').value = user.last_name || '';
                    document.getElementById('registrationDate').value = 
                        user.created_at ? new Date(user.created_at).toLocaleDateString('ru-RU') : '';
                    document.getElementById('subscriptionStatus').value = user.is_premium ? '–ü—Ä–µ–º–∏—É–º' : '–ë–∞–∑–æ–≤–∞—è';
                    document.getElementById('userRole').value = user.role || 'student';
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function loadUserStats() {
            try {
                console.log('üìä –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –¥—ç—à–±–æ—Ä–¥–∞...');
                
                const token = localStorage.getItem('token');
                if (!token) return;
                
                const response = await fetch('/api/user/stats', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const stats = await response.json();
                    console.log('‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞:', stats);
                    
                    // –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                    animateStatNumber('totalTests', stats.tests_taken || 0);
                    animateStatNumber('averageScore', Math.round(stats.average_score || 0), '%');
                    animateStatNumber('studyDays', stats.study_days || 0);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
                    updateProgressChart(stats.weekly_activity || []);
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥–ª—É—à–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ
                ['totalTests', 'averageScore', 'studyDays'].forEach(id => {
                    const element = document.getElementById(id);
                    if (element) element.textContent = '–Ω/–¥';
                });
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
        async function loadAchievements() {
            try {
                console.log('üèÜ –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è...');
                
                const token = localStorage.getItem('token');
                if (!token) return;
                
                const response = await fetch('/api/user/stats', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const stats = await response.json();
                    const achievements = stats.achievements || [];
                    console.log('‚úÖ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', achievements.length);
                    
                    const container = document.getElementById('achievementsList');
                    
                    if (achievements.length === 0) {
                        container.innerHTML = `
                            <div style="text-align: center; color: var(--text-secondary); padding: 2rem;">
                                <div style="font-size: 2rem; margin-bottom: 1rem;">üèÜ</div>
                                <p>–ü—Ä–æ–π–¥–∏—Ç–µ –ø–µ—Ä–≤—ã–π —Ç–µ—Å—Ç, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è!</p>
                                <a href="testing.html" class="btn btn-primary" style="margin-top: 1rem; display: inline-block;">
                                    üöÄ –ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
                                </a>
                            </div>
                        `;
                    } else {
                        const latestAchievements = achievements.slice(-5); // –ü–æ—Å–ª–µ–¥–Ω–∏–µ 5 –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
                        container.innerHTML = latestAchievements.map(achievement => `
                            <div style="
                                display: flex;
                                align-items: center;
                                padding: 0.75rem;
                                margin-bottom: 0.5rem;
                                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                                color: white;
                                border-radius: 8px;
                                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                            ">
                                <span style="font-size: 1.5rem; margin-right: 1rem;">${achievement.icon}</span>
                                <div>
                                    <div style="font-weight: 600;">${achievement.name}</div>
                                    <div style="font-size: 0.85rem; opacity: 0.9;">${achievement.description}</div>
                                </div>
                            </div>
                        `).join('');
                        
                        if (achievements.length > 5) {
                            container.innerHTML += `
                                <div style="text-align: center; margin-top: 1rem;">
                                    <a href="profile.html" style="color: var(--primary-color); text-decoration: none; font-size: 0.9rem;">
                                        –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ ${achievements.length} –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π ‚Üí
                                    </a>
                                </div>
                            `;
                        }
                    }
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π:', error);
                document.getElementById('achievementsList').innerHTML = `
                    <div style="text-align: center; color: var(--text-secondary); padding: 2rem;">
                        <div style="color: #ef4444;">‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</div>
                    </div>
                `;
            }
        }

        // –ê–Ω–∏–º–∞—Ü–∏—è —á–∏—Å–µ–ª –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function animateStatNumber(elementId, targetValue, suffix = '') {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            const startValue = 0;
            const duration = 1500;
            const startTime = Date.now();
            
            function updateNumber() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                const easeProgress = 1 - Math.pow(1 - progress, 3);
                const currentValue = Math.floor(startValue + (targetValue - startValue) * easeProgress);
                
                element.textContent = currentValue + suffix;
                
                if (progress < 1) {
                    requestAnimationFrame(updateNumber);
                }
            }
            
            updateNumber();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        function updateProgressChart(weeklyActivity) {
            const container = document.getElementById('progressChart');
            
            if (!weeklyActivity || weeklyActivity.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; color: var(--text-secondary);">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üìà</div>
                        <p>–ì—Ä–∞—Ñ–∏–∫ –ø–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤</p>
                        <a href="testing.html" class="btn btn-primary" style="margin-top: 1rem; display: inline-block;">
                            üìù –ü—Ä–æ–π—Ç–∏ –ø–µ—Ä–≤—ã–π —Ç–µ—Å—Ç
                        </a>
                    </div>
                `;
                return;
            }
            
            // –ü—Ä–æ—Å—Ç–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∑–∞ –Ω–µ–¥–µ–ª—é
            const maxTests = Math.max(...weeklyActivity.map(day => day.tests_count));
            const chartHtml = weeklyActivity.map((day, index) => {
                const height = maxTests > 0 ? (day.tests_count / maxTests) * 100 : 0;
                const date = new Date(day.test_date);
                const dayName = date.toLocaleDateString('ru-RU', { weekday: 'short' });
                
                return `
                    <div style="
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        flex: 1;
                        margin: 0 0.25rem;
                    ">
                        <div style="
                            height: 120px;
                            display: flex;
                            align-items: end;
                            margin-bottom: 0.5rem;
                        ">
                            <div style="
                                width: 20px;
                                height: ${height}%;
                                background: linear-gradient(135deg, #667eea, #764ba2);
                                border-radius: 4px 4px 0 0;
                                min-height: ${day.tests_count > 0 ? '10px' : '2px'};
                            " title="${day.tests_count} —Ç–µ—Å—Ç–æ–≤, —Å—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª ${Math.round(day.avg_score || 0)}%"></div>
                        </div>
                        <div style="font-size: 0.8rem; color: var(--text-secondary);">${dayName}</div>
                        <div style="font-size: 0.75rem; font-weight: 600; color: var(--primary-color);">${day.tests_count}</div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = `
                <div style="display: flex; align-items: end; height: 100%; padding: 1rem;">
                    ${chartHtml}
                </div>
                <div style="text-align: center; margin-top: 0.5rem; font-size: 0.85rem; color: var(--text-secondary);">
                    –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
                </div>
            `;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏
        function checkAdminAccess() {
            if (currentUser && (currentUser.role === 'admin' || currentUser.role === 'teacher')) {
                console.log('üëë –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏');
                showAdminActions();
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –∞–¥–º–∏–Ω—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
        function showAdminActions() {
            // –ù–∞–π–¥–µ–º —Å–µ–∫—Ü–∏—é –±—ã—Å—Ç—Ä—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –∏ –¥–æ–±–∞–≤–∏–º –∞–¥–º–∏–Ω—Å–∫–∏–µ –∫–Ω–æ–ø–∫–∏
            const quickActionsGrid = document.querySelector('.card-body .grid.grid-3');
            if (quickActionsGrid) {
                const adminCard = `
                    <div class="feature-card" onclick="openAdminPanel()" style="cursor: pointer; border: 2px solid #f59e0b;">
                        <div class="feature-icon" style="color: #f59e0b;">‚öôÔ∏è</div>
                        <h3 style="color: #f59e0b;">–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h3>
                        <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</p>
                    </div>
                `;
                quickActionsGrid.innerHTML += adminCard;
            }
            
            // –î–æ–±–∞–≤–∏–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∞–¥–º–∏–Ω–∞ –≤ —à–∞–ø–∫—É
            const navbar = document.querySelector('.nav-links');
            if (navbar && !document.getElementById('adminIndicator')) {
                const adminIndicator = document.createElement('span');
                adminIndicator.id = 'adminIndicator';
                adminIndicator.innerHTML = 'üëë –ê–¥–º–∏–Ω';
                adminIndicator.style.cssText = `
                    background: linear-gradient(135deg, #f59e0b, #d97706);
                    color: white;
                    padding: 0.25rem 0.75rem;
                    border-radius: 20px;
                    font-size: 0.85rem;
                    font-weight: 600;
                    margin-right: 1rem;
                `;
                navbar.insertBefore(adminIndicator, navbar.firstChild);
            }
        }

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏
        function openAdminPanel() {
            console.log('‚öôÔ∏è –ü–µ—Ä–µ—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å...');
            window.open('http://localhost:3002', '_blank');
        }
    </script>
</body>
</html>